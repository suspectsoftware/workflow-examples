name: Go Build and Test
description: Composite action to build and test a Go project

inputs:
  build-command:
    description: Command to build the Go project
    required: false
    default: go build ./...
  binary-path:
    description: Path to the compiled binary to upload as an artifact
    required: false
    default: main

outputs:
  build-status:
    description: Status of the build step
    value: ${{ steps.build.outcome }}

runs:
  using: composite
  steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '>=1.24'

    - name: Build project
      id: build
      shell: bash
      run: |
        echo "Building project with command: ${{ inputs.build-command }}"
        ${{ inputs.build-command }}

    - name: Upload binary artifact
      if: ${{ steps.build.outcome == 'success' }}
      uses: actions/upload-artifact@v4
      with:
        name: go-binary
        path: ${{ inputs.binary-path }}

    - name: Build summary
      shell: bash
      run: |
        echo "### Go Build Summary" >> $GITHUB_STEP_SUMMARY
        echo "- Build Status: ${{ steps.build.outcome }}" >> $GITHUB_STEP_SUMMARY
