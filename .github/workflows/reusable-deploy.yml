name: Reusable Deployment Workflow

on:
  workflow_call:
    inputs:
      environment:
        description: 'Target environment (staging/production)'
        required: true
        type: string
      artifact-name:
        description: 'Name of the artifact to deploy'
        required: false
        type: string
        default: 'build-artifact'
    secrets:
      DEPLOY_TOKEN:
        description: 'Token for deployment authentication'
        required: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: ${{ inputs.artifact-name }}
          path: ./dist
      
      - name: Validate deployment target
        run: |
          echo "Deploying to environment: ${{ inputs.environment }}"
          if [[ "${{ inputs.environment }}" != "staging" && "${{ inputs.environment }}" != "production" ]]; then
            echo "Error: Invalid environment specified"
            exit 1
          fi
      
      - name: Deploy to ${{ inputs.environment }}
        env:
          DEPLOY_TOKEN: ${{ secrets.DEPLOY_TOKEN }}
        run: |
          echo "Deploying artifact: ${{ inputs.artifact-name }}"
          echo "Environment: ${{ inputs.environment }}"
          # Actual deployment commands would go here
          # For example: scp, rsync, cloud provider CLI, etc.
          echo "Deployment completed successfully!"
      
      - name: Post-deployment verification
        run: |
          echo "Verifying deployment..."
          # Health check or smoke tests would go here
          echo "Verification completed!"
